[package]
name = "wallet-core"
version = "0.1.0"
edition = "2021"

[lib]
crate-type = ["cdylib", "rlib"]

[dependencies]
wasm-bindgen = "0.2"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
js-sys = "0.3"
# Explicitly add getrandom 0.2 with js feature to ensure WASM compatibility
# This helps when some transitive dependencies use getrandom 0.2
getrandom = { version = "0.2", features = ["js"] }

# CLI dependencies
clap = { version = "4.5", features = ["derive"] }
anyhow = "1.0"

# Core crypto dependencies - always available (work in WASM)
bip0039 = "0.12"
zcash_keys = { version = "0.12", default-features = false, features = ["orchard"] }
zcash_protocol = { version = "0.7", default-features = false }
zcash_address = { version = "0.10", default-features = false }
zip32 = "0.2"
rand = { version = "0.8", features = ["getrandom"] }

# Native-only Zcash dependencies (SQLite, proofs, gRPC)
# Updated to zcash_client_sqlite 0.19+ for NU6.1 support (activated Nov 24, 2025)
zcash_client_backend = { version = "0.21", optional = true, features = ["orchard"] }
zcash_client_sqlite = { version = "0.19", optional = true, features = ["orchard"] }
rusqlite = { version = "0.37", optional = true }
zcash_primitives = { version = "0.26", optional = true }
hex = { version = "0.4", optional = true }
secrecy = { version = "0.8", optional = true }
zcash_proofs = { version = "0.26", optional = true, default-features = false, features = ["local-prover", "multicore"] }
nonempty = { version = "0.11", optional = true }

# gRPC dependencies for lightwalletd integration
tonic = { version = "0.11", optional = true }
prost = { version = "0.12", optional = true }
prost-types = { version = "0.12", optional = true }
tokio = { version = "1", features = ["rt", "rt-multi-thread", "macros"], optional = true }

[build-dependencies]
tonic-build = { version = "0.11", optional = true }

[features]
default = []
native = ["zcash_client_backend", "zcash_client_sqlite", "zcash_primitives", "hex", "tonic", "prost", "prost-types", "tokio", "tonic-build", "rusqlite", "secrecy", "zcash_proofs", "nonempty"]

[[bin]]
name = "zchat-wallet"
path = "src/bin/zchat_wallet.rs"
required-features = ["native"]


# Configure getrandom for WASM - both 0.2 and 0.3 will be handled
# getrandom 0.3 will use wasm-bindgen automatically when available
# For getrandom 0.2, we need to ensure js feature is enabled via dependency features

